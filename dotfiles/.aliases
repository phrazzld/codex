#!/usr/bin/env zsh

# Detect the current host
HOSTNAME="$(hostname)"

# Universal aliases
alias agent='eval "$(ssh-agent -s)"; ssh-add ~/.ssh/id_rsa'
alias clear="clear && source ~/.zshrc && exec zsh"
alias compress='tar czf'
alias decompress='tar xzf'
alias f='fzf --bind "enter:execute(nvim {})"'
alias c='claude --dangerously-skip-permissions'
alias cw='clauditor --watch'
alias e='node $DEVELOPMENT/elevator/dist/cli.js'
alias cub='ccusage blocks --live'
alias cx='codex --search --dangerously-bypass-approvals-and-sandbox'
alias g='gemini'
alias o='opencode'

# Git aliases
alias gs='git status --short'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git pull'
alias gd='git diff'
alias gds='git diff --staged'
alias gdn='git diff --name-only'
alias gap='git add -p'
alias gch='git checkout'
alias gchb='gch -b'
alias gil='git checkout main && git pull'
alias gal='git checkout master && git pull'
alias gu='git config --local --list | grep "user"'
alias gm='git status --porcelain | awk "{print \$2}" | xargs $EDITOR'
alias resolve-conflicts="git diff --name-only | uniq | xargs nvim"
alias rc='resolve-conflicts'
alias trigger-build='git commit --allow-empty -m "trigger build" && git push'

# Enhanced Git Visibility Aliases
alias gse='echo "ğŸ“Š Git Status Summary"; echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"; echo "ğŸ“ Staged changes: $(git diff --cached --numstat | awk "{sum += \$1 + \$2} END {print sum}")"; echo "ğŸ”„ Unstaged changes: $(git diff --numstat | awk "{sum += \$1 + \$2} END {print sum}")"; echo "ğŸ“ Untracked files: $(git ls-files --others --exclude-standard | wc -l | xargs)"; echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"; git status -s'
alias ga-stats='git shortlog -sn --no-merges'
alias grecent='git for-each-ref --count=10 --sort=-committerdate refs/heads/ --format="%(refname:short) (%(committerdate:relative))"'
alias gstandup='git log --since=yesterday --author="$(git config user.name)" --pretty=format:"%h - %s"'
alias gpulse='echo "ğŸ“ˆ Project Pulse (last 7 days):"; echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"; echo "Commits: $(git log --since="1 week ago" --pretty=oneline | wc -l | xargs)"; echo "Authors: $(git shortlog --since="1 week ago" -sn | wc -l | xargs)"; echo "Lines added: $(git log --since="1 week ago" --numstat --pretty="%H" | awk "NF==3" | awk "{sum += \$1} END {print sum}")"; echo "Lines removed: $(git log --since="1 week ago" --numstat --pretty="%H" | awk "NF==3" | awk "{sum += \$2} END {print sum}")"; echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"'
alias goverview='echo "ğŸ”­ Repository Overview"; echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"; echo "Current branch: $(git branch --show-current)"; echo "Active since: $(git log --reverse --date=format:"%Y-%m-%d" --pretty=format:"%ad" | head -1)"; echo "Total commits: $(git rev-list --count HEAD)"; echo "Total contributors: $(git shortlog -sn | wc -l | xargs)"; echo "Total files: $(git ls-files | wc -l | xargs)"; echo "Total lines: $(git ls-files | xargs wc -l 2>/dev/null | tail -1)"; echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"'
alias gbranch-age='echo "ğŸ•°ï¸  Branch Age:"; echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"; for branch in $(git for-each-ref --format="%(refname:short)" refs/heads); do echo "$branch: $(git log -1 --pretty=format:"%cr" $branch)"; done | sort -k2,3'
alias gstash-list='echo "ğŸ“¦ Stash Overview:"; echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"; git stash list --pretty=format:"%gd: %s" | while read stash; do stash_id=$(echo $stash | cut -d: -f1); echo "$stash"; echo "   Files: $(git stash show $stash_id | wc -l | xargs)"; echo "   Changes: +$(git stash show $stash_id | awk "{sum+=\$1} END {print sum}") -$(git stash show $stash_id | awk "{sum+=\$2} END {print sum}")"; echo ""; done'
alias gwte='echo "ğŸŒ³ Git Worktrees:"; echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"; git worktree list | while read line; do dir=$(echo $line | awk "{print \$1}"); branch=$(echo $line | awk "{print \$3}" | tr -d "[]"); echo "ğŸ“ $(basename $dir) - ğŸŒ¿ $branch"; echo "   $(cd $dir && git log -1 --pretty=format:"Last commit: %s (%cr)" HEAD)"; echo ""; done'
# gwtn function available from .fun - creates worktree with new branch

# Enhanced Git Functions
# Git Branch Diff - show line difference stats between current branch and main/master
gbd() {
  local main_branch=$(git rev-parse --verify main 2>/dev/null && echo "main" || echo "master")
  echo "ğŸ” Branch diff with $main_branch"
  echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
  echo "ğŸ“ˆ Added lines: $(git diff $main_branch... --numstat | awk '{sum += $1} END {print sum}')"
  echo "ğŸ“‰ Removed lines: $(git diff $main_branch... --numstat | awk '{sum += $2} END {print sum}')"
  echo "ğŸ“„ Files changed: $(git diff $main_branch... --name-only | wc -l | xargs)"
  echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
}

# Git File History - shows commit history for a specific file
gfh() {
  if [ -z "$1" ]; then
    echo "Usage: gfh <file_path>"
    return 1
  fi
  git log --follow --pretty=format:"%C(yellow)%h %C(red)%ad %C(blue)%an%C(green)%d %C(reset)%s" --date=short "$1"
}

# Git Commit Streak - show commit streak for the current user
gstreak() {
  local author="${1:-$(git config user.name)}"
  local today=$(date +%Y-%m-%d)
  local days=${2:-30}
  local start_date=$(date -v-${days}d +%Y-%m-%d)

  echo "ğŸ”¥ Commit Streak for $author (last $days days)"
  echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

  for i in $(seq 0 $days); do
    local check_date=$(date -v-${i}d +%Y-%m-%d)
    local count=$(git log --author="$author" --format=oneline --after="$check_date 00:00" --before="$check_date 23:59" | wc -l | xargs)

    if [ $count -eq 0 ]; then
      local marker="âšª"
    elif [ $count -lt 3 ]; then
      local marker="ğŸŸ¢"
    elif [ $count -lt 10 ]; then
      local marker="ğŸŸ¡"
    else
      local marker="ğŸ”´"
    fi

    echo "$marker $check_date: $count commits"
  done
  echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
}

# Todo.txt (topydo) aliases
alias t='topydo -t ~/Documents/daybook/todo.txt -d ~/Documents/daybook/done.txt'
alias ta='t add'
alias tl='t ls'
alias td='t do'
alias te='t edit'
alias ttoday='t ls due:today'
alias toverdue='t ls "due:<today"'
alias thabits='t ls +habits'
alias tnext='t ls -n 10'
alias tstreak='~/Documents/daybook/scripts/habit-streak.sh'
alias tstreaks='~/Documents/daybook/scripts/habit-streaks.sh'

# General shortcuts
alias s='speedtest'
alias sz="exec zsh"
alias v=nvim
alias vz="nvim ~/.zshrc"
alias vn="nvim ~/.config/nvim/init.lua"
alias nvim-clean-shada='rm -f ~/.local/state/nvim/shada/main.shada.tmp.*'
alias xit="exit"
alias vimv="$HOME/Development/vimv"
alias ts="todo-stats"
alias python="python3"
alias prd="pnpm run dev"
alias prdf="pnpm run dev:full"

# Overmind - portfolio command center
alias dash='cd ~/Development/overmind && pnpm dev'
alias dash-html='cd ~/Development/overmind && pnpm dev -- --html && open ~/overmind.html'

alias l="eza --long --all --git --icons --group-directories-first --color=never"
alias ls="eza --icons --group-directories-first --color=never"
alias ll="eza --long --git --icons --group-directories-first --color=never"
alias la="eza --long --all --git --icons --group-directories-first --color=never"
alias lt="eza --tree --git --icons --group-directories-first --color=never"
alias lta="eza --tree --all --git --icons --group-directories-first --color=never"
alias dark="kitty +kitten themes --reload-in=all RosÃ© Pine Moon"
alias light="kitty +kitten themes --reload-in=all RosÃ© Pine Dawn"
alias dev="$DEVELOPMENT/codex/bin/tmux-startup"
alias nerdfetch="$DEVELOPMENT/nerdfetch"
# p() function defined in ~/.fun (journal entry with frontmatter)
# Legacy ponder tool available at: $DEVELOPMENT/ponder/target/release/ponder
alias yt='yarn test'
alias meme="$HOME/Development/random-meme.sh"
alias vcc="v $HOME/Library/Application\ Support/Claude/claude_desktop_config.json"
alias gsl='git checkout stable && git pull'

# Search with ripgrep, open in Neovim
vrgi() {
  local results=$(rg -il "$@")
  if [[ -n "$results" ]]; then
    echo "$results" | xargs nvim
  else
    echo "No files found containing: $@"
  fi
}

vrg() {
  local results=$(rg -l "$@")
  if [[ -n "$results" ]]; then
    echo "$results" | xargs nvim
  else
    echo "No files found containing: $@"
  fi
}

# System health monitoring
alias memhogs='ps aux -m | head -15'
alias swapcheck='sysctl vm.swapusage'
alias diskcheck='df -h /System/Volumes/Data'
alias cache-clean='brew cleanup --prune=all && go clean -cache && pnpm store prune && pip cache purge'

# Start9 Embassy aliases
alias embassy='open http://192.168.1.78'
alias embassy-chrome='open -a "Google Chrome" http://192.168.1.78'
alias embassy-ssh='ssh start@192.168.1.78'
alias embassy-check='ping -c 3 192.168.1.78'
alias embassy-status='curl -I http://192.168.1.78 2>&1 | head -5'
