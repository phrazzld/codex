# PLAN

## 1. SELECT TASK
- Read `BACKLOG.md` and identify the top item as the task description string.

## 2. PREPARE TASK FILE
- Create a file named `TASK-PROMPT.md`.
- Write the following into `TASK-PROMPT.md`:
    ```markdown
    # Task Planning Request

    ## Task Description
    [Insert task description string from Step 1]

    ## Request
    Analyze the task description within the project context. Propose potential implementation plans. For each plan:
    1.  Outline the main approach and key steps.
    2.  Discuss potential pros and cons (consider maintainability, performance, alignment with existing code).
    3.  **Critically evaluate the TESTABILITY of the approach according to TESTING_PHILOSOPHY.MD.** How easily can this approach be tested with simple, reliable tests, minimizing mocks?
    4.  Highlight any potential risks or challenges.

    Recommend the best overall plan, explicitly justifying the choice based on requirements, project standards, and **prioritizing long-term maintainability and testability.**
    ```

## 3. GENERATE PLAN WITH THINKTANK
- **Goal:** Use `thinktank` to generate potential implementation plans from multiple LLMs based on the task description and project context.
- **Actions:**
    - **Initial Attempt (Full Context):** Run the following command:
        ```bash
        thinktank run --group faves TASK-PROMPT.md ./
        ```
    - **Handle Errors:** If `thinktank` fails:
        - Report the specific error message.
        - Write the error to a persistent log file.
        - Analyze the error. Attempt to fix and retry **once** if feasible.
        - If unresolvable, report "Thinktank CLI invocation failed. See error above. Manual assistance required." and **stop**.
    - **Identify Output Directory:** If the command completes successfully, identify the output directory path created by `thinktank`. Report "Thinktank CLI invocation successful. Responses saved in <output-directory-path>."

## 4. SYNTHESIZE PLAN
- **Goal:** Consolidate the plans generated by different LLMs into a single, coherent `PLAN.MD`, prioritizing testability.
- **Actions:**
    - Navigate to the identified `thinktank` output directory.
    - Read all the individual model response files (`*.md`).
    - **Synthesize:** ***Think hard*** and synthesize the proposed steps, approaches, considerations (especially testability evaluations), and potential challenges from the various LLM responses into a single, comprehensive, and actionable plan.
    - **Prioritize:** When resolving contradictions or choosing between approaches, give significant weight to the plan that offers the best **testability** and **maintainability** according to `TESTING_PHILOSOPHY.MD`, even if slightly more complex initially, unless there's a compelling reason otherwise (e.g., major performance impact). Document this reasoning.
    - Save this synthesized plan to `PLAN.MD`.
    - (Optional Cleanup): Remove the temporary `TASK-PROMPT.md` file.

## 5. CHECKOUT BRANCH
- Switch to a new git branch for implementing the work described in the synthesized `PLAN.MD`.
